#include <gui/screen_screen/screenView.hpp>
#include <cstring>
#include "main.h"
#include "usb_host.h"
#include "fatfs.h"

extern "C" uint8_t doWrite;
extern "C" QueueHandle_t toDisplayQueue;


const uint8_t imageStaticData[] =
{ 164, 73, 163, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
		255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 36, 28, 237, 36,
		28, 237, 204, 72, 63, 204, 72, 63, 204, 72, 63, 204, 72, 63, 164, 73,
		163, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
		255, 255, 255, 255, 255, 36, 28, 237, 36, 28, 237, 36, 28, 237, 255,
		255, 255, 204, 72, 63, 204, 72, 63, 204, 72, 63, 204, 72, 63, 164, 73,
		163, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 36, 28,
		237, 36, 28, 237, 36, 28, 237, 255, 255, 255, 255, 255, 255, 255, 255,
		255, 204, 72, 63, 204, 72, 63, 204, 72, 63, 204, 72, 63, 164, 73, 163,
		255, 255, 255, 36, 28, 237, 36, 28, 237, 36, 28, 237, 255, 255, 255,
		255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
		255, 204, 72, 63, 204, 72, 63, 204, 72, 63, 204, 72, 63, 164, 73, 163,
		255, 255, 255, 36, 28, 237, 255, 255, 255, 39, 127, 255, 39, 127, 255,
		39, 127, 255, 39, 127, 255, 39, 127, 255, 39, 127, 255, 76, 177, 34,
		204, 72, 63, 204, 72, 63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 39,
		127, 255, 39, 127, 255, 39, 127, 255, 255, 255, 255, 255, 255, 255, 255,
		255, 255, 255, 255, 255, 255, 255, 255, 76, 177, 34, 39, 127, 255, 204,
		72, 63, 204, 72, 63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 39, 127,
		255, 255, 255, 255, 255, 255, 255, 39, 127, 255, 39, 127, 255, 39, 127,
		255, 39, 127, 255, 76, 177, 34, 255, 255, 255, 255, 255, 255, 204, 72,
		63, 204, 72, 63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 39, 127, 255,
		255, 255, 255, 255, 255, 255, 39, 127, 255, 255, 255, 255, 255, 255,
		255, 39, 127, 255, 39, 127, 255, 255, 255, 255, 255, 255, 255, 204, 72,
		63, 204, 72, 63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 36, 28, 237,
		39, 127, 255, 255, 255, 255, 39, 127, 255, 255, 255, 255, 76, 177, 34,
		76, 177, 34, 39, 127, 255, 39, 127, 255, 255, 255, 255, 204, 72, 63,
		204, 72, 63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 255, 255, 255, 39,
		127, 255, 39, 127, 255, 255, 255, 255, 39, 127, 255, 39, 127, 255, 39,
		127, 255, 39, 127, 255, 39, 127, 255, 39, 127, 255, 204, 72, 63, 204,
		72, 63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 255, 255, 255, 255, 255,
		255, 39, 127, 255, 39, 127, 255, 76, 177, 34, 76, 177, 34, 255, 255,
		255, 255, 255, 255, 255, 255, 255, 39, 127, 255, 204, 72, 63, 204, 72,
		63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 255, 255, 255, 255, 255,
		255, 255, 255, 255, 255, 255, 255, 39, 127, 255, 39, 127, 255, 255, 255,
		255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 204, 72, 63, 204, 72,
		63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 255, 255, 255, 255, 255,
		255, 255, 255, 255, 76, 177, 34, 76, 177, 34, 255, 255, 255, 39, 127,
		255, 39, 127, 255, 39, 127, 255, 255, 255, 255, 204, 72, 63, 204, 72,
		63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 255, 255, 255, 255, 255,
		255, 255, 255, 255, 76, 177, 34, 255, 255, 255, 255, 255, 255, 255, 255,
		255, 255, 255, 255, 255, 255, 255, 39, 127, 255, 204, 72, 63, 204, 72,
		63, 204, 72, 63, 204, 72, 63, 164, 73, 163, 255, 255, 255, 255, 255,
		255, 76, 177, 34, 76, 177, 34, 255, 255, 255, 255, 255, 255, 255, 255,
		255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 204, 72, 63, 204, 72,
		63, 204, 72, 63, 204, 72, 63 };

constexpr uint8_t imgWidth = 15, imgHeight = 15;
uint8_t *dynamicImageBuffer
{ nullptr };

screenView::screenView()
{
	dynamicBitmapId = Bitmap::dynamicBitmapCreate(imgWidth, imgHeight,
			Bitmap::RGB888);
	Bitmap dynamicBitmap = Bitmap(dynamicBitmapId);
	uint8_t *dynBuffer = Bitmap::dynamicBitmapGetAddress(dynamicBitmapId);

	std::memcpy(dynBuffer, imageStaticData, sizeof(imageStaticData)/2);
	dynamicImage.setBitmap(dynamicBitmap);
	dynamicImage.setXY(85, 165);
	dynamicImage.setScalingAlgorithm(ScalableImage::NEAREST_NEIGHBOR);
	dynamicImage.setWidthHeight(150, 150);
	add(dynamicImage);
}
extern ApplicationTypeDef Appli_state;


void screenView::setupScreen()
{
	screenViewBase::setupScreen();
}

void screenView::tearDownScreen()
{
	screenViewBase::tearDownScreen();
}

void screenView::writeRadioCallback()
{
	Unicode::snprintf(textAreaBuffer, textAreaBufferSize, "Writing!");
	textArea1.setWildcard(textAreaBuffer);
	textArea1.invalidate();
	doWrite = 1;
}

void screenView::readRadioCallback()
{
	Unicode::snprintf(textAreaBuffer, textAreaBufferSize, "Reading!");
	textArea1.setWildcard(textAreaBuffer);
	textArea1.invalidate();
	doWrite = 0;
}
